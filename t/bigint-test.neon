IMPORT bigint
IMPORT math
IMPORT sys

FUNCTION basic()
    LET a: bigint.BigInt := bigint.make(12345)
    print(a.toString())
--= 12345

    LET b: bigint.BigInt := bigint.make(23456)
    print(b.toString())
--= 23456

    LET sum: bigint.BigInt := bigint.add(a, b)
    print(sum.toString())
--= 35801

    LET diff: bigint.BigInt := bigint.sub(b, a)
    print(diff.toString())
--= 11111

    LET prod: bigint.BigInt := bigint.mul(a, b)
    print(prod.toString())
--= 289564320

    --LET quot: bigint.BigInt := bigint.div(b, a)
    --print(quot.toString())
----= 1

    print("\(bigint.make(-12345))")
--= -12345
END FUNCTION

FOR lx := -30 TO 30 DO
    FOR ly := -30 TO 30 DO
        LET x: Number := math.floor(math.exp(math.abs(lx))) * math.sign(lx)
        LET y: Number := math.floor(math.exp(math.abs(ly))) * math.sign(ly)
        test_arithmetic(x, y)
        IF lx = 0 THEN
            test_arithmetic(0, y)
        END IF
        IF ly = 0 THEN
            test_arithmetic(x, 0)
        END IF
    END FOR
END FOR

FUNCTION test_arithmetic(x, y: Number)
    LET p: bigint.BigInt := bigint.make(x)
    LET q: bigint.BigInt := bigint.make(y)

    LET rsum: bigint.BigInt := bigint.make(x + y)
    IF NOT p.add(q).equals(rsum) THEN
        print("fail: \(x) + \(y) expected \(x + y) got \(rsum)")
        sys.exit(1)
    END IF

    LET rdiff: bigint.BigInt := bigint.make(x - y)
    IF NOT p.sub(q).equals(rdiff) THEN
        print("fail: \(x) - \(y) expected \(x - y) got \(rdiff)")
        sys.exit(1)
    END IF

    IF math.abs(x * y) < 10000000000000000 THEN
        LET rprod: bigint.BigInt := bigint.make(x * y)
        IF NOT p.mul(q).equals(rprod) THEN
            print("fail: \(x) * \(y) expected \(x * y) got \(rprod)")
            sys.exit(1)
        END IF
    END IF

    --LET rquot: bigint.BigInt := bigint.make(x / y)
    --IF NOT p.div(q).equals(rquot) THEN
    --    print("fail: \(x) / \(y) expected \(x / y) got \(rquot)")
    --    sys.exit(1)
    --END IF

END FUNCTION

FUNCTION extended()
    LET a: Number := 2^1000
    TESTCASE a = 10715086071862673209484250490600018105614048117055336074437503883703510511249361224931983788156958581275946729175531468251871452856923140435984577574698574803934567774824230985421074605062371141877954182153046474983581941267398767559165543946077062914571196477686542167660429831652624386837205668069376
    TESTCASE str(a) = "10715086071862673209484250490600018105614048117055336074437503883703510511249361224931983788156958581275946729175531468251871452856923140435984577574698574803934567774824230985421074605062371141877954182153046474983581941267398767559165543946077062914571196477686542167660429831652624386837205668069376"
    LET b: Number := a + 1
    TESTCASE b = 10715086071862673209484250490600018105614048117055336074437503883703510511249361224931983788156958581275946729175531468251871452856923140435984577574698574803934567774824230985421074605062371141877954182153046474983581941267398767559165543946077062914571196477686542167660429831652624386837205668069377
    TESTCASE str(b) = "10715086071862673209484250490600018105614048117055336074437503883703510511249361224931983788156958581275946729175531468251871452856923140435984577574698574803934567774824230985421074605062371141877954182153046474983581941267398767559165543946077062914571196477686542167660429831652624386837205668069377"

    TESTCASE a + b = 21430172143725346418968500981200036211228096234110672148875007767407021022498722449863967576313917162551893458351062936503742905713846280871969155149397149607869135549648461970842149210124742283755908364306092949967163882534797535118331087892154125829142392955373084335320859663305248773674411336138753

    TESTCASE b - a = 1

    LET c: Number := a * b

    TESTCASE c = 114813069527425452423283320117768198402231770208869520047764273682576626139237031385665948631650626991844596463898746277344711896086305533142593135616665318539129989145312280000688779148240044871428926990063486244781615463646388363947317026040466353970904996558162398808944629605623311649536164221970343396430240771657667989852870084826019672949051831836503440220590329341033257493461213275549424841898482545724571949595273651311260965300289167829115588008706026488329782014575093113765144328358508536937533472058709597469616185186991220052861352846797196371913215342990503200649618078149022056817098752

    TESTCASE c / a = b

    TESTCASE b MOD a = 1

    LET d: Number := -a
    TESTCASE d = -10715086071862673209484250490600018105614048117055336074437503883703510511249361224931983788156958581275946729175531468251871452856923140435984577574698574803934567774824230985421074605062371141877954182153046474983581941267398767559165543946077062914571196477686542167660429831652624386837205668069376

    TESTCASE math.abs(d) = a

    TESTCASE math.sign(d) = -1

    TESTCASE math.ceil(a) = a
    TESTCASE math.floor(a) = a
    TESTCASE math.trunc(a) = a

    TESTCASE math.odd(b)
END FUNCTION

basic()
--extended()
